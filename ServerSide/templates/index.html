<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Screenshot Monitor</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet"               href="{{ url_for('static', filename='style.css') }}">

    <script>
        async function updateGauge() {
            const res = await fetch("/data");
            const data = await res.json();

            document.getElementById("percent").textContent = data.percent + "%";
            document.getElementById("used").textContent = data.used + " GB";
            document.getElementById("free").textContent = data.free + " GB";
            document.getElementById("total").textContent = data.total + " GB";

            const circle = document.querySelector(".circle");
            circle.style.background = `conic-gradient(#0077cc ${data.percent}%, #eee ${data.percent}%)`;
        }
        setInterval(updateGauge, 60000);
        window.onload = updateGauge;
    </script>
</head>
<body>


<h2 style="display: flex; justify-content: space-between; align-items: center;">
    ğŸ“ Screenshot Directory Viewer
    <a href="{{ url_for('logout') }}" class="logout-button">ğŸ”’ Logout</a>
</h2>


<!-- ====================== HOST LOOP ====================== -->
{% for host, host_dates in data.items() %}
<details class="level-0">
    <summary>
        ğŸ–¥ï¸ {{ host }}
    </summary>

    {% for date, users in host_dates.items() %}
    <details class="level-1">
        <summary>ğŸ“… {{ date }}</summary>

        {% for user, d in users.items() %}
        <details class="level-2">
            <summary>ğŸ‘¤ {{ user }} â€” ğŸ–¼ï¸ {{ d.screens.count }} | ğŸï¸ {{ d.videos.count }}</summary>

            <ul class="level-3">
                <!-- IMAGES -->
                {% for file in d.screens.files %}
                <li>
                    ğŸ–¼ï¸
                    <a href="{{ url_for('download_file', host=host, date=date, user=user, filename=file) }}">
                        {{ file }}
                    </a>
                </li>
                {% endfor %}

                <!-- VIDEOS -->
                {% for file in d.videos.files %}
                <li>
                    ğŸï¸
                    <a href="{{ url_for('download_file', host=host, date=date, user=user, filename=file) }}">
                        {{ file }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </details>
        {% endfor %}
    </details>
    {% endfor %}
</details>
{% endfor %}



<!-- ====================== FOOTER ====================== -->
<div class="info">
    ğŸ’¾ <strong>Total screenshots size:</strong> {{ sum }} MB |
    ğŸï¸ <strong>Total video size:</strong> {{ vsum }} MB
</div>

<hr>

<div class="footer">
    <div class="gauge">
        <div class="progress-container">
            <div class="progress-bar" style="width: {{ info.percent }}%;">
                Disk Usage {{ info.percent }}%
            </div>
        </div>
    </div>

    <p>
        <strong>Total:</strong> <span id="total">{{ info.total }} GB</span> /
        <strong>Used:</strong> <span id="used">{% set total = sum + vsum %}{{ total < 1024 and (total ~ ' MB') or (round(total / 1024, 2) ~ ' GB') }}</span>
        <strong>Free:</strong> <span id="free">{{ info.free }} GB</span>
    </p>

    host = {{ host }}
</div>


</body>
</html>
